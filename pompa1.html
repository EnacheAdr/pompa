<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Status Pompa</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      margin: 0;
      font-family: 'Orbitron', sans-serif;
      background: url('imaginea2.webp') no-repeat center center fixed;
      background-size: cover;
      color: white;
      overflow-x: hidden;
    }

    h1 {
      text-align: center;
      font-size: 3rem;
      margin: 1.2rem 0 0.5rem;
    }

    .legend-box {
      text-align: center;
      background-color: red;
      display: inline-block;
      padding: 0.4rem 1rem;
      border-radius: 10px;
      margin-bottom: 1rem;
      font-weight: bold;
    }

    .chart-container {
      width: 100%;
      overflow-x: auto;
      padding-bottom: 1rem;
      margin-top: 0.5rem;
    }

    .chart-wrapper {
      min-width: 1300px;
      height: 250px;
    }

    .scroll-hint {
      text-align: center;
      color: yellow;
      font-size: 0.9rem;
      margin-bottom: 1.2rem;
    }

    .status-box {
      background: rgba(0, 0, 0, 0.7);
      padding: 1.5rem;
      margin: 2rem auto;
      border-radius: 20px;
      box-shadow: 0 0 15px #00ffcc;
      text-align: center;
      width: 90%;
      max-width: 600px;
    }

    .status-box h2 {
      color: #00ffcc;
      font-size: 1.5rem;
      margin-bottom: 1rem;
    }

    .performance-label {
      background-color: #f1c40f;
      color: black;
      display: inline-block;
      padding: 0.5rem 1rem;
      border-radius: 10px;
      font-weight: bold;
      margin-bottom: 1rem;
    }

    .progress-bar-bg {
      background-color: #555;
      border-radius: 20px;
      overflow: hidden;
      height: 30px;
      margin-bottom: 1rem;
    }

    .progress-bar-fill {
      height: 100%;
      text-align: center;
      font-weight: bold;
      line-height: 30px;
    }

    .alert-message {
      padding: 1rem;
      border-radius: 10px;
      font-weight: bold;
    }

    .alert-green {
      background-color: #2ecc71;
    }

    .alert-yellow {
      background-color: #f1c40f;
      color: black;
    }

    .alert-red {
      background-color: #e74c3c;
    }
  </style>
</head>
<body>

  <h1>Pompa 1</h1>
  <div class="legend-box">Performanța actuală a pompei</div>

  <div class="chart-container">
    <div class="chart-wrapper">
      <canvas id="healthChart"></canvas>
    </div>
  </div>

  <div class="scroll-hint">⚠️ Pentru o vizualizare completă, utilizați bara de derulare de mai sus.</div>

  <div class="status-box">
    <h2>Timp estimat de viață rămas al pompei: <span id="lifeTime">...</span></h2>
    <div class="performance-label" id="perfLabel">Sănătate/performanță actuală a pompei: ...%</div>
    <div class="progress-bar-bg">
      <div id="progressBar" class="progress-bar-fill" style="width: 0%; background-color: gray;">...</div>
    </div>
    <div id="alertBox" class="alert-message">...</div>
  </div>

  <script>
    // Simulate date din Firebase
    const citiri = Array.from({length: 230}, (_, i) => ({
      nume: "Citirea " + (i + 1),
      sanatate: Math.floor(Math.random() * 26) + 74, // între 74% și 100%
      debit: Math.random() * 8 + 30,                 // 30 - 38 L/h
      curent: Math.random() * 50 + 250               // 250 - 300 mA
    }));

    const sanatati = citiri.map(c => c.sanatate);
    const labels = citiri.map(c => c.nume);
    const minSanatate = Math.min(...sanatati);
    const minIndex = sanatati.indexOf(minSanatate);
    const ultimaSanatate = sanatati[sanatati.length - 1];

    const chartData = {
      labels: labels,
      datasets: [{
        label: "Sănătate pompa (%)",
        data: sanatati,
        borderColor: "#00ffe6",
        backgroundColor: sanatati.map((v, i) => i === minIndex ? "#ff0000" : "#00ffe6"),
        pointBackgroundColor: sanatati.map((v, i) => i === minIndex ? "#ff0000" : "#00ffe6"),
        fill: false,
        tension: 0.3
      }]
    };

    const config = {
      type: 'line',
      data: chartData,
      options: {
        responsive: true,
        scales: {
          y: {
            title: { display: true, text: 'Sănătate/performanță', color: '#fff' },
            beginAtZero: false,
            min: 60,
            max: 100,
            ticks: { color: '#fff' }
          },
          x: {
            ticks: { color: '#fff', maxRotation: 90, minRotation: 45 }
          }
        },
        plugins: {
          tooltip: {
            callbacks: {
              label: function(ctx) {
                const i = ctx.dataIndex;
                const citire = citiri[i];
                return `Sănătate: ${citire.sanatate}%\nDebit: ${citire.debit.toFixed(1)} L/h\nCurent: ${citire.curent.toFixed(1)} mA`;
              }
            }
          },
          legend: { display: false }
        }
      }
    };

    new Chart(document.getElementById('healthChart'), config);

    // Estimare timp rămas
    const totalOre = 500;
    const nrCitiri = citiri.length;
    const timpConsumSec = nrCitiri * 30;
    const timpConsumOre = timpConsumSec / 3600;
    const degradareOre = ((100 - minSanatate) / 100) * totalOre;
    const timpRamas = Math.max(totalOre - timpConsumOre - degradareOre, 0);

    const ore = Math.floor(timpRamas);
    const minute = Math.floor((timpRamas - ore) * 60);
    const secunde = Math.floor(((timpRamas - ore) * 60 - minute) * 60);
    document.getElementById('lifeTime').textContent = `${ore} ore, ${minute} minute, ${secunde} secunde`;

    // Bara sănătate actuală
    const bara = document.getElementById("progressBar");
    bara.style.width = `${(timpRamas / totalOre) * 100}%`;
    bara.textContent = `${Math.floor(timpRamas)} ore`;

    const perfLabel = document.getElementById("perfLabel");
    perfLabel.textContent = `Sănătate/performanță actuală a pompei: ${ultimaSanatate}%`;

    // Alerte
    const alertBox = document.getElementById("alertBox");
    if (timpRamas > 300) {
      bara.style.backgroundColor = "#2ecc71";
      alertBox.className = "alert-message alert-green";
      alertBox.textContent = "✅ Pompa funcționează în parametri optimi. Nu sunt semne de uzură semnificativă.";
    } else if (timpRamas > 150) {
      bara.style.backgroundColor = "#f1c40f";
      alertBox.className = "alert-message alert-yellow";
      alertBox.textContent = "⚠️ Atenție: semne moderate de scădere a performanței. Pompa funcționează, dar eficiența sa a început să scadă. Se recomandă o verificare tehnică pentru prevenirea defecțiunii premature.";
    } else {
      bara.style.backgroundColor = "#e74c3c";
      alertBox.className = "alert-message alert-red";
      alertBox.textContent = "❗ Avertisment: performanță critică detectată! Este necesară o intervenție tehnică imediată pentru a evita defecțiuni majore.";
    }
  </script>

</body>
</html>
